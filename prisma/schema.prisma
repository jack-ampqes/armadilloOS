// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Product {
  id          String   @id @default(cuid())
  name        String
  description String?
  sku         String   @unique
  price       Float
  category    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  orderItems   OrderItem[]
  inventory    Inventory?

  @@map("products")
}

model Customer {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  phone     String?
  address   String?
  city      String?
  state     String?
  zipCode   String?
  country   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  orders Order[]

  @@map("customers")
}

model Order {
  id          String   @id @default(cuid())
  orderNumber String   @unique
  customerId  String
  salesRepId  String?
  status      String   @default("PENDING")
  totalAmount Float
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  customer   Customer    @relation(fields: [customerId], references: [id])
  salesRep   SalesRep?   @relation(fields: [salesRepId], references: [id])
  orderItems OrderItem[]

  @@map("orders")
}

model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  productId String
  quantity  Int
  unitPrice Float
  totalPrice Float

  // Relations
  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])

  @@map("order_items")
}

model SalesRep {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  phone     String?
  territory String?
  commissionRate Float?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  orders Order[]

  @@map("sales_reps")
}

model Distributor {
  id          String   @id @default(cuid())
  name        String
  contactName String?
  email       String   @unique
  phone       String?
  address     String?
  city        String?
  state       String?
  zipCode     String?
  country     String?
  discountRate Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("distributors")
}

model Inventory {
  id          String   @id @default(cuid())
  productId   String   @unique
  quantity    Int      @default(0)
  minStock    Int      @default(0)
  location    String?
  lastUpdated DateTime @default(now())

  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("inventory")
}

model Quote {
  id            String   @id @default(cuid())
  quoteNumber   String   @unique
  status        String   @default("DRAFT")
  
  // Customer info
  customerName  String
  customerEmail String?
  customerPhone String?
  customerAddress String?
  customerCity    String?
  customerState   String?
  customerZip     String?
  customerCountry String?
  
  // Pricing
  subtotal      Float
  discountType  String?     // "percentage" or "fixed"
  discountValue Float?
  discountAmount Float       @default(0)
  total         Float
  
  // Dates
  validUntil    DateTime?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  
  // Optional notes
  notes         String?
  
  // Relations
  quoteItems    QuoteItem[]

  @@map("quotes")
}

model QuoteItem {
  id          String  @id @default(cuid())
  quoteId     String
  productId   String?
  productName String
  sku         String?
  quantity    Int
  unitPrice   Float
  totalPrice  Float

  // Relations
  quote Quote @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@map("quote_items")
}

model Alert {
  id          String   @id @default(cuid())
  type        String   // 'low_stock', 'out_of_stock', 'pending_order', 'quote_expired', 'manufacturer_order'
  severity    String   // 'critical', 'warning', 'info'
  title       String
  message     String
  entityType  String?  // 'product', 'order', 'quote', 'manufacturer_order'
  entityId    String?
  read        Boolean  @default(false)
  resolved    Boolean  @default(false)
  createdAt   DateTime @default(now())
  resolvedAt  DateTime?

  @@map("alerts")
}

model ActivityLog {
  id          String   @id @default(cuid())
  action      String   // 'created', 'updated', 'deleted'
  entityType  String   // 'order', 'quote', 'inventory', 'product', 'customer'
  entityId    String
  userId      String?
  details     String?  // JSON string with change details
  createdAt   DateTime @default(now())

  @@map("activity_logs")
}

